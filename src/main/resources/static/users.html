<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>사용자 목록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="icon" href="data:,">
    <script src="/js/app.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }
        .main-card {
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: none;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="card main-card">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">
                    <i class="bi bi-people-fill text-primary me-2"></i>사용자 목록
                </h2>
                <div>
                    <a class="btn btn-outline-secondary me-2" href="/">
                        <i class="bi bi-house me-1"></i>홈으로
                    </a>
                    <button class="btn btn-primary" id="reload">
                        <i class="bi bi-arrow-clockwise me-1"></i>새로고침
                    </button>
                </div>
            </div>
            
            <div class="alert alert-warning" id="hint" style="display:none;">
                <i class="bi bi-exclamation-triangle me-2"></i>로그인이 필요합니다. 먼저 로그인 후 다시 시도하세요.
            </div>
            
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>이메일</th>
                            <th>이름</th>
                            <th>생성일</th>
                        </tr>
                    </thead>
                    <tbody id="rows">
                        <tr>
                            <td colspan="4" class="text-center text-muted py-4">
                                <span class="spinner-border spinner-border-sm me-2"></span>로딩 중...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  async function loadUsers() {
    const rows = document.getElementById('rows');
    const hint = document.getElementById('hint');
    rows.innerHTML = '';
    
    if (!App.isLoggedIn()) {
      hint.style.display = 'block';
      rows.innerHTML = '<tr><td colspan="4" class="text-center text-muted py-4">로그인이 필요합니다</td></tr>';
      return;
    }
    
    hint.style.display = 'none';
    rows.innerHTML = '<tr><td colspan="4" class="text-center text-muted py-4"><span class="spinner-border spinner-border-sm me-2"></span>로딩 중...</td></tr>';
    
    try {
      const res = await App.apiFetch('/api/users');
      if (!res.ok) throw new Error(await res.text());
      const list = await res.json();
      
      if (list.length === 0) {
        rows.innerHTML = '<tr><td colspan="4" class="text-center text-muted py-4">사용자가 없습니다</td></tr>';
        return;
      }
      
      for (const u of list) {
        const tr = document.createElement('tr');
        const createdAt = u.createdAt ? new Date(u.createdAt).toLocaleString('ko-KR') : '-';
        tr.innerHTML = `
          <td><span class="badge bg-primary">${u.id}</span></td>
          <td><i class="bi bi-envelope me-2"></i>${u.email}</td>
          <td><strong>${u.name}</strong></td>
          <td>${createdAt}</td>
        `;
        rows.appendChild(tr);
      }
    } catch (e) {
      rows.innerHTML = `<tr><td colspan="4" class="text-center text-danger py-4">불러오기 실패: ${e.message}</td></tr>`;
    }
  }
  document.getElementById('reload').addEventListener('click', loadUsers);
  loadUsers();
</script>
</body>
</html>


